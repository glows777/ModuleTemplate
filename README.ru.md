*Read this in other languages: [English](README.md), [Russian](README.ru.md).*

## Описание структуры модуля расширения ##

Модуль расширения подключается из дополнительной папки после установки MikoPBX.
Модуль может иметь свой интерфейс, свои файлы стилей, JS скрипты, контроллер, модели, собственную базу данных

## Структура папок модуля расширения ##

В папке **app** хранятся подключаемые контроллеры, представления в веб форме, обработчики форм.

В папке **bin** хранятся дополнительные бинарники, необходимые для работы модуля

В папке **coreapi** хранятся подключаемые автоматически расширения coreapi, которые добавляют новые REST методы, необходимые для работы модуля

В папке **db** будет создаваться и храниться база данных module.db в формате sqlite3, создается автоматически согдасно описанной ORM модели

В папке **Lib** классы и методы расширения, которые взаимодействуют с ядром PBX

В папке **messages** хранятся подключаемые файлы перевода ru.php, en.php и т.д.

В папке **Models** хранятся подключаемые ORM модели для хранения настроек и допоплнительных данных модуля 

В папке **public** хранятся статические публичные файлы, картинки, JS скрипты, CSS стили.

В папке **setup** хранятся файлы необходимые для установки и удаления модуля, а также настройки Firewall если модулю требуется открыть дополнительные порты.


### Установочный файл  PbxExtensionSetup.php ###
Обязательно содержит следующие функции
  * installDB() - Создает структуру для хранения настроек модуля в своей модели и заполняет настройки по-умолчанию если таблицы не было в системе см. (unInstallDB)
  * installFiles() - Выполняет копирование необходимых файлов, в папки системы
  * unInstallDB () - Удаление модели и настроек, если передан флаг удаления
  * unInstallFiles () - Удаление файлов модуля из системы

### Класс модели ###
Обазательно с namespace вида `Modules\<НазваниеКласса>\Models`, сама модель должна расширять класс **ModelBase**
В модели должна присутвовать функция **getRepresent()** отвечающая за текстовое представление элементов в модели. Например при удалении сотрудника участвующего в настройках модуля, система выведет сообщение о том что в месте с названием **=getRepresent()** есть ссылка на сотрудника.

### Класс контроллера ###
В контроллере, в конце каждого метода имеющего представление, необходимо указывать путь к View файлу конкретного модуля, чтобы система не пыталась искать его по общему пути, где хранится ядро системы.
Напрмер так
`$this->view->pick( "{$modulesDir}/ModuleSmartIVR/app/views/index" );`

### Перевод ###
В массиве фраз с преводом обязательно наличие двух параметров
	* Breadcrumb<НазваниеКласса> - здесь хранится название модуля для заголовка
	* SubHeader<НазваниеКласса> - краткое описание о том что делает этот модуль для подзаголовка